/*
 * Copyright Â© 2021 Zecrey Protocol
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */

package std

import (
	"fmt"
	"github.com/consensys/gnark-crypto/ecc"
	"github.com/consensys/gnark/frontend"
	"github.com/consensys/gnark/frontend/cs/r1cs"
	"github.com/consensys/gnark/test"
	curve "github.com/zecrey-labs/zecrey-crypto/ecc/ztwistededwards/tebn254"
	"github.com/zecrey-labs/zecrey-crypto/elgamal/twistededwards/tebn254/twistedElgamal"
	"github.com/zecrey-labs/zecrey-crypto/zecrey/twistededwards/tebn254/zecrey"
	"math/big"
	"testing"
)

func TestVerifyPTransferProofCircuit(t *testing.T) {
	assert := test.NewAssert(t)
	var circuit, witness TransferProofConstraints
	r1cs, err := frontend.Compile(ecc.BN254, r1cs.NewBuilder, &circuit, frontend.IgnoreUnconstrainedInputs())
	if err != nil {
		t.Fatal(err)
	}
	sk1, pk1 := twistedElgamal.GenKeyPair()
	b1 := uint64(8)
	r1 := curve.RandomValue()
	_, pk2 := twistedElgamal.GenKeyPair()
	b2 := big.NewInt(2)
	r2 := curve.RandomValue()
	_, pk3 := twistedElgamal.GenKeyPair()
	b3 := big.NewInt(3)
	r3 := curve.RandomValue()
	b1Enc, err := twistedElgamal.Enc(big.NewInt(int64(b1)), r1, pk1)
	b2Enc, err := twistedElgamal.Enc(b2, r2, pk2)
	b3Enc, err := twistedElgamal.Enc(b3, r3, pk3)
	if err != nil {
		t.Fatal(err)
	}
	fee := uint64(1)
	relation, err := zecrey.NewTransferProofRelation(1, fee)
	if err != nil {
		t.Fatal(err)
	}
	err = relation.AddStatement(b2Enc, pk2, 0, 2, nil)
	if err != nil {
		t.Fatal(err)
	}
	err = relation.AddStatement(b1Enc, pk1, b1, -3, sk1)
	if err != nil {
		t.Fatal(err)
	}
	err = relation.AddStatement(b3Enc, pk3, 0, 0, nil)
	if err != nil {
		t.Fatal(err)
	}
	proof, err := zecrey.ProveTransfer(relation)
	if err != nil {
		t.Fatal(err)
	}
	proof, _ = zecrey.ParseTransferProofStr("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")
	fmt.Println("constraints:", r1cs.GetNbConstraints())
	witness, err = SetTransferProofWitness(proof, true)
	if err != nil {
		t.Fatal(err)
	}
	//assert.ProverSucceeded(r1cs, &witness)

	assert.SolvingSucceeded(&circuit, &witness, test.WithCurves(ecc.BN254), test.WithCompileOpts(frontend.IgnoreUnconstrainedInputs()))

}
